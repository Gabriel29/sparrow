import std.ptr
import std.union

datatype myType
    a: Int
    b: StaticArray(UByte, 100)

datatype innerType
    a: StaticArray(UInt, 25)

datatype outerType
    a: StaticArray(UByte, 9)
    b: innerType

/*<<<UnionSameType(1)
10
>>>*/
fun test1
    var union : Union(Int, Int)
    union.get1 = 10

    cout << (union.get2) << endl

/*<<<UnionDiffType(2)
27
>>>*/
fun test2
    var union: Union(Int, Char)
    union.get1 = 7963
    
    cout << Byte(union.get2) << endl

/*<<<UnionArray(3)
27
31
0
0
>>>*/
fun test3
    var union: Union(Int, StaticArray(Byte,4))
    union.get1 = 7963
    
    cout << (union.get2).at(0) << endl
    cout << (union.get2).at(1) << endl
    cout << (union.get2).at(2) << endl
    cout << (union.get2).at(3) << endl

/*<<<SizeOfUnion(4)
20
>>>*/
fun test4
    var union: Union(Int, StaticArray(Byte, 20), Float)
    
    cout << sizeOf(union) << endl

/*<<<ComplexSizeOfUnion(5)
800
>>>*/
fun test5
    var union: Union(Int, \
                     StaticArray(Int, 100), \
                     Float, \
                     StaticArray(Byte, 100), \
                     Char, \
                     Long, \
                     StaticArray(Long, 100))
    
    cout << sizeOf(union) << endl

/*<<<ComplexUnion(6)
1600
210
2
150
73
>>>*/
fun test6
    var union: Union(Int, \
                     StaticArray(UInt, 100), \
                     Float, \
                     StaticArray(UByte, 100), \
                     Char, \
                     Long, \
                     StaticArray(Int, 100), \
                     StaticArray(Float, 100), \
                     StaticArray(Char, 100), \
                     StaticArray(Long, 100), \
                     StaticArray(ULong, 200))
    
    (union.get6) = 1234567890

    cout << sizeOf(union) << endl

    cout << (union.get4).at(0) << endl
    cout << (union.get4).at(1) << endl
    cout << (union.get4).at(2) << endl
    cout << (union.get4).at(3) << endl

/*<<<UnionStruct(7)
104
>>>*/
fun test7
    var union: Union(Int, StaticArray(Byte, 20), myType) 
    cout << sizeOf(union) << endl

/*<<<UnionComplexStruct(8)
109
12345
1
65536
16777216
>>>*/
fun test8
    var union: Union(myType, innerType, StaticArray(Byte, 20), outerType, ULong, UInt)
    (union.get1).a = 12345
    ((union.get1).b).at(2) = UByte(1)
    (union.get3).at(19) = Byte(1)

    cout << sizeOf(union) << endl
    cout << union.get6 << endl
    cout << ((union.get4).a).at(6) << endl
    cout << (((union.get4).b).a).at(2) << endl
    cout << ((union.get2).a).at(4) << endl

fun sprMain
    if ( programArgs.size() < 2 )
        return;
    var n = programArgs(1) asInt;

    if      n == 1  ; test1
    else if n == 2  ; test2
    else if n == 3  ; test3
    else if n == 4  ; test4
    else if n == 5  ; test5
    else if n == 6  ; test6
    else if n == 7  ; test7
    else if n == 8  ; test8